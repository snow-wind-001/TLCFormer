# OSFormer RGBT-Tiny æ•°æ®é›†é…ç½®

# æ•°æ®é›†é…ç½®
data:
  root_dir: /home/a7532/dataset/RGBT-Tiny
  num_workers: 4
  modality: both  # 'rgb', 'thermal', 'both'
  
  # è‡ªåŠ¨è·Ÿè¸ªé…ç½®ï¼ˆç”¨äºç”Ÿæˆ tracking_id å’Œè®¡ç®— offsetï¼‰
  tracking:
    enabled: true           # æ˜¯å¦å¯ç”¨è‡ªåŠ¨è·Ÿè¸ª
    iou_threshold: 0.3      # IoU åŒ¹é…é˜ˆå€¼
    distance_threshold: 0.1 # ä¸­å¿ƒè·ç¦»é˜ˆå€¼ï¼ˆå½’ä¸€åŒ–ï¼‰
    iou_weight: 0.7         # IoU æƒé‡
    distance_weight: 0.3    # è·ç¦»æƒé‡

# æ¨¡å‹é…ç½®
model:
  num_frames: 5              # è¾“å…¥è§†é¢‘å¸§æ•° T
  frame_interval: 3          # å¸§é‡‡æ ·é—´éš” (1=å¯†é›†é‡‡æ ·, 3=æ¨è, 5=æ¿€è¿›)
  sample_frames: 3           # é‡‡æ ·å¸§æ•° S
  img_size: 640              # å›¾åƒå°ºå¯¸
  num_classes: 7             # RGBT-Tinyæœ‰7ä¸ªç±»åˆ«
  embed_dim: 96              # VPA åµŒå…¥ç»´åº¦
  depths: [2, 2, 6, 2]       # VPA å„é˜¶æ®µæ·±åº¦
  use_doppler: true          # æ˜¯å¦ä½¿ç”¨ Doppler æ»¤æ³¢
  anchor_free: true          # æ˜¯å¦ä½¿ç”¨ anchor-free æ£€æµ‹
  dropout: 0.1               # Dropout æ¦‚ç‡

# ç±»åˆ«é…ç½®
classes:
  names: ['ship', 'car', 'cyclist', 'pedestrian', 'bus', 'drone', 'plane']
  # ç±»åˆ«æƒé‡ï¼ˆå¯é€‰ï¼Œç”¨äºå¤„ç†ç±»åˆ«ä¸å¹³è¡¡ï¼‰
  weights: [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]

# è®­ç»ƒé…ç½®
train:
  batch_size: 4              # å‡å°batch sizeé€‚åº”å¤šç±»åˆ«
  num_epochs: 50
  lr: 0.001                  # å­¦ä¹ ç‡
  weight_decay: 0.05         # æƒé‡è¡°å‡
  warmup_epochs: 5           # Warmup è½®æ•°

  # ä¼˜åŒ–å™¨
  optimizer: adamw
  betas: [0.9, 0.999]

  # å­¦ä¹ ç‡è°ƒåº¦
  scheduler: cosine
  min_lr: 0.00001

  # æ··åˆç²¾åº¦è®­ç»ƒ
  amp: true

  # æ¢¯åº¦è£å‰ªï¼ˆå¢åŠ åˆ° 5.0 ä»¥æé«˜æ•°å€¼ç¨³å®šæ€§ï¼‰
  clip_grad: 5.0

  # æŸå¤±æƒé‡ï¼ˆå¤šç±»åˆ«éœ€è¦è°ƒæ•´ï¼‰
  # ğŸ”¥ ä¿®å¤Losså¼‚å¸¸ä½ï¼šæå‡clsæƒé‡ï¼Œè®©åˆ†ç±»èƒ½å¤Ÿå­¦ä¹ 
  loss_weights:
    cls: 2.0  # ä»0.2æå‡åˆ°2.0ï¼Œç¡®ä¿åˆ†ç±»å­¦ä¹  â­â­â­
    bbox: 3.0
    centerness: 3.0  # ğŸ”¥ ä»2.0æå‡åˆ°3.0ï¼Œæé«˜centernessé¢„æµ‹å‡†ç¡®åº¦ â­â­
    offset: 1.0  # ä»2.0é™åˆ°1.0ï¼Œæ•°æ®é›†é™åˆ¶
    
    # ğŸ†• ç±»åˆ«æƒé‡ï¼šè§£å†³ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜ â­â­â­
    # æƒé‡åŸºäº 1/sqrt(frequency) å½’ä¸€åŒ–
    # ship(0): 0.21, car(1): 0.10, cyclist(2): 0.19, pedestrian(3): 0.13
    # bus(4): 0.29, drone(5): 0.35, plane(6): 0.26, background(7): 0.05
    # ğŸ”¥ å…³é”®ä¿®å¤ï¼šæ·»åŠ èƒŒæ™¯ç±»æƒé‡ï¼ˆID=7ï¼‰ï¼Œé˜²æ­¢ç´¢å¼•è¶Šç•Œ â­â­â­
    class_weights: [0.21, 0.10, 0.19, 0.13, 0.29, 0.35, 0.26, 0.05]
  
  # æ•°å€¼ç¨³å®šæ€§é…ç½®
  nan_detection: true        # æ˜¯å¦æ£€æµ‹å¹¶å¤„ç†NaN
  check_loss_interval: 100   # æ¯Nä¸ªbatchæ£€æŸ¥ä¸€æ¬¡æŸå¤±

# å¯è§†åŒ–é…ç½®
visualize:
  enabled: true               # æ˜¯å¦å¯ç”¨å¯è§†åŒ–
  max_samples: 4             # æ¯æ¬¡å¯è§†åŒ–æœ€å¤šæ ·æœ¬æ•°
  score_thresh: 0.001          # é¢„æµ‹æ¡†æ˜¾ç¤ºé˜ˆå€¼

# è¯„ä¼°é…ç½®
eval:
  batch_size: 2              # è¯„ä¼°æ—¶batch sizeå¯ä»¥æ›´å°
  eval_interval: 5           # è¯„ä¼°é—´éš”ï¼ˆepochï¼‰
  score_thresh: 0.05           # ğŸ”¥ ä»0.001æå‡åˆ°0.05ï¼Œå‡å°‘è¯¯æ£€ â­â­â­
  nms_thresh: 0.5              # NMS é˜ˆå€¼
  max_detections: 100          # ğŸ†• æ¯å¼ å›¾æœ€å¤šä¿ç•™100ä¸ªæ£€æµ‹æ¡† â­â­â­

  # è¯„ä¼°æŒ‡æ ‡
  metrics:
    - map50_95
    - map50
    - map75
    - precision
    - recall

# æ—©é€€æœºåˆ¶é…ç½®
early_stopping:
  enabled: true              # æ˜¯å¦å¯ç”¨æ—©é€€
  patience: 25               # å®¹å¿çš„epochæ•°ï¼ˆ15ä¸ªepochæ²¡æœ‰æ”¹è¿›åˆ™åœæ­¢ï¼‰
  min_delta: 0.001           # æœ€å°æ”¹è¿›é‡ï¼ˆå°äºæ­¤å€¼è§†ä¸ºæ²¡æœ‰æ”¹è¿›ï¼‰
  metric: map50              # ç›‘æ§çš„æŒ‡æ ‡ (map50, map75, loss)
  mode: max                  # 'max' è¡¨ç¤ºæŒ‡æ ‡è¶Šå¤§è¶Šå¥½ï¼Œ'min' è¡¨ç¤ºè¶Šå°è¶Šå¥½

# ä¿å­˜é…ç½®
save:
  checkpoint_dir: ./checkpoints/rgbt_tiny
  log_dir: ./logs/rgbt_tiny
  tensorboard_dir: ./runs/rgbt_tiny  # TensorBoard æ—¥å¿—ç›®å½•
  save_interval: 5          # ä¿å­˜é—´éš”ï¼ˆepochï¼‰
  keep_last_k: 3             # ä¿ç•™æœ€è¿‘ k ä¸ªæ£€æŸ¥ç‚¹
  save_best: true            # æ˜¯å¦ä¿å­˜æœ€ä½³æ¨¡å‹
  best_metric: map50         # ç”¨äºåˆ¤æ–­æœ€ä½³æ¨¡å‹çš„æŒ‡æ ‡ (map50, map75, loss)

# å¯è§†åŒ–é…ç½®
visualize:
  enabled: true
  vis_dir: ./visualizations/rgbt_tiny
  num_vis: 10                # å¯è§†åŒ–æ ·æœ¬æ•°
  save_predictions: true     # ä¿å­˜é¢„æµ‹ç»“æœ

# è®¾å¤‡é…ç½®
device: cuda
seed: 42

# æ•°æ®å¢å¼º
augmentation:
  enabled: true
  random_flip: 0.5
  random_crop: false
  color_jitter: 0.2
  # å¤šå°ºåº¦è®­ç»ƒ
  multi_scale: true
  scale_range: [0.8, 1.2]

# ç±»åˆ«ç‰¹å®šé…ç½®
class_specific:
  # å°ç›®æ ‡ç±»åˆ«ï¼ˆéœ€è¦ç‰¹æ®Šå¤„ç†ï¼‰
  small_objects: ['drone', 'cyclist']

  # å›°éš¾ç±»åˆ«ï¼ˆå¯èƒ½éœ€è¦æ›´å¤šè®­ç»ƒï¼‰
  hard_classes: ['cyclist', 'pedestrian']

  # ç±»åˆ«ç‰¹å®šçš„æŸå¤±æƒé‡
  loss_weights:
    drone: 2.0      # æ— äººæœºç›®æ ‡å°ï¼Œå¢åŠ æƒé‡
    cyclist: 1.5    # éª‘è¡Œè€…è¾ƒå°‘ï¼Œå¢åŠ æƒé‡
    pedestrian: 1.2 # è¡Œäººè¾ƒå¤šï¼Œä¿æŒæ­£å¸¸æƒé‡